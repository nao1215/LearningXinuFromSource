@brief ARM (32bit)用のコンテキストスイッチを行う。

## コンテキストスイッチ ctxsw.S

@details C 言語からは、ctxsw(&old_sp, &new_sp)という形式で使用する。<br>
@param[in] old_sp：プロセステーブル中のカレントプロセススタックポインタ<br>
@param[in] new_sp：新しいプロセスのスタックポインタ<br>
<br>

## 前提知識：ARM 32bit レジスタ

| レジスタ | 別名 | 役割                                                 |
| -------- | ---- | ---------------------------------------------------- |
| r0       | a1   | 汎用レジスタ（引数の受け渡し、関数の返り値に使用）   |
| r1       | a2   | 汎用レジスタ（引数の受け渡し、関数の返り値に使用）   |
| r2       | a3   | 汎用レジスタ（引数の受け渡し、関数の返り値に使用）   |
| r3       | a4   | 汎用レジスタ（引数の受け渡し、関数の返り値に使用）   |
| r4       | v1   | 汎用レジスタ                                         |
| r5       | v2   | 汎用レジスタ                                         |
| r6       | v3   | 汎用レジスタ                                         |
| r7       | v4   | 汎用レジスタ                                         |
| r8       | v5   | 汎用レジスタ                                         |
| r9       | sb   | 汎用レジスタ（静的データセグメントのベースアドレス） |
| r10      | sl   | 汎用レジスタ （スタックリミット）                    |
| r11      | fp   | 汎用レジスタ（フレームポインタ）                     |
| r12      | ip   | プロシージャ内呼び出しスクラッチレジスタ             |
| r13      | sp   | スタックポインタ                                     |
| r14      | lr   | リンクレジスタ（リターンアドレス）                   |
| r15      | pc   | プログラムカウンタ                                   |
| cpsr     | -    | カレントプログラムステータスレジスタ（コプロセッサ） |

## 前提知識：ARM 32bit 命令

| 命令 | 役割                                                     |
| ---- | -------------------------------------------------------- |
| push | レジスタ値をメモリに保存する                             |
| pop  | レジスタ値をメモリから復元する                           |
| mrs  | コプロセッサから汎用レジスタに値を移す                   |
| mov  | レジスタからレジスタに値を移動する                       |
| str  | レジスタからメモリに値を移動する                         |
| ldr  | レジスタからレジスタに値を読み込む                       |
| bl   | ラベル先へ分岐し、次の命令アドレスを r14(lr)にコピーする |

## ソースコード

```
	.text
	.globl	ctxsw

ctxsw:
	push	{r0-r11, lr}    /* r0〜r11およびlrをメモリに保存する */
	push	{lr}            /* リターンアドレスを保存する        */
	mrs	r2, cpsr            /* cpsrコプロセッサからステータスを取得する */
	push	{r2}            /* ステータスをメモリに保存する */
	str	sp, [r0]            /* カレントプロセスのスタックポインタをメモリに保存する。*/
	ldr	sp, [r1]            /* 新しいプロセスのスタックポインタをメモリから読み込む	*/
	pop	{r0}                /* 引数としてステータスをメモリから取得する	*/
	bl	restore             /* restore命令を呼び出し、リストアを行う */
	pop	{lr}                /* リターンアドレスを取得する */
	pop	{r0-r12}            /* 汎用レジスタをリストアする */
	mov	pc, r12	            /* 新しいプロセスに戻る	*/
```
